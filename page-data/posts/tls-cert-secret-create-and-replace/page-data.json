{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/posts/tls-cert-secret-create-and-replace/","result":{"data":{"post":{"html":"<h2 id=\"tl-dr\" style=\"position:relative;\"><a href=\"#tl-dr\" aria-label=\"tl dr permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TL; DR</h2>\n<ul>\n<li>\n<p>아래의 명령어는 kubernetes 1.19 버전에서 진행하였습니다.</p>\n</li>\n<li>\n<p>인증서 생성</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret tls <span class=\"token variable\">${secret-tls-name}</span> <span class=\"token parameter variable\">--key</span> <span class=\"token variable\">${tls-key}</span> <span class=\"token parameter variable\">--cert</span> <span class=\"token variable\">${tls-cert}</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">${namespace}</span> --save-config</code></pre></div>\n<ul>\n<li>인증서 생성(yaml)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret tls <span class=\"token variable\">${secret-tls-name}</span> <span class=\"token parameter variable\">--key</span> <span class=\"token variable\">${tls-key}</span> <span class=\"token parameter variable\">--cert</span> <span class=\"token variable\">${tls-cert}</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">${namespace}</span> --dry-run<span class=\"token operator\">=</span>client <span class=\"token parameter variable\">-o</span> yaml <span class=\"token operator\">></span> secret.yaml</code></pre></div>\n<ul>\n<li>인증서 교체</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret tls <span class=\"token variable\">${secret-tls-name}</span> <span class=\"token parameter variable\">--key</span> <span class=\"token variable\">${tls-key}</span> <span class=\"token parameter variable\">--cert</span> <span class=\"token variable\">${tls-cert}</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">${namespace}</span> --dry-run<span class=\"token operator\">=</span>client <span class=\"token parameter variable\">-o</span> yaml <span class=\"token operator\">|</span> kubectl apply <span class=\"token parameter variable\">-f</span> -</code></pre></div>\n<h2 id=\"소개\" style=\"position:relative;\"><a href=\"#%EC%86%8C%EA%B0%9C\" aria-label=\"소개 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>소개</h2>\n<ul>\n<li>쿠버네티스는 클러스터 외부에서 들어오는 L7 트래픽을 처리하기 위해 ingress resource를 사용합니다.</li>\n<li>이 때, TLS 기능을 사용하는 경우 다음과 같은 형식으로 secret resource를 생성해야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>secret<span class=\"token punctuation\">-</span>tls\n<span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">tls.crt</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># base64 encoded cert</span>\n  <span class=\"token key atrule\">tls.key</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># base64 encoded key</span>\n<span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> kubernetes.io/tls</code></pre></div>\n<ul>\n<li>그리고 ingress resource yaml 명세의 .spec.tls[].secretName에 생성한 secret의 이름을 지정해야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>ingress\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">tls</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">hosts</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> example.foo.com\n    <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> example<span class=\"token punctuation\">-</span>secret<span class=\"token punctuation\">-</span>tls\n  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> example.foo.com\n      <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /\n          <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix\n          <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span>\n            <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span> \n              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> bar\n              <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span>\n               <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre></div>\n<h3 id=\"인증서-생성\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%83%9D%EC%84%B1\" aria-label=\"인증서 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증서 생성</h3>\n<ul>\n<li>직접 key와 cert를 base64로 인코딩한 후에 secret resource를 생성해도 되지만 번거롭습니다.</li>\n<li>kubectl create secret tls 명령어를 이용하면 손 쉽게 ingress에서 사용할 tls secret을 생성할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret tls <span class=\"token variable\">${secret-tls-name}</span> <span class=\"token parameter variable\">--key</span> <span class=\"token variable\">${tls-key}</span> <span class=\"token parameter variable\">--cert</span> <span class=\"token variable\">${tls-cert}</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">${namespace}</span> --save-config`</code></pre></div>\n<h3 id=\"인증서-교체\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EA%B5%90%EC%B2%B4\" aria-label=\"인증서 교체 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증서 교체</h3>\n<ul>\n<li>--dry-run 옵션과 -o yaml 옵션을 이용하여 kubectl create secret tls 명령으로부터 yaml 명세를 얻어낼 수 있고, 해당 yaml을 이용하여 인증서를 교체할 수 있습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">kubectl create secret tls <span class=\"token variable\">${secret-tls-name}</span> <span class=\"token parameter variable\">--key</span> <span class=\"token variable\">${tls-key}</span> <span class=\"token parameter variable\">--cert</span> <span class=\"token variable\">${tls-cert}</span> <span class=\"token parameter variable\">-n</span> <span class=\"token variable\">${namespace}</span> --dry-run <span class=\"token parameter variable\">-o</span> yaml <span class=\"token operator\">|</span> kubectl apply <span class=\"token parameter variable\">-f</span> -</code></pre></div>\n<h2 id=\"참고\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0\" aria-label=\"참고 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고</h2>\n<ul>\n<li><a href=\"https://kubernetes.io/docs/concepts/services-networking/ingress/\">https://kubernetes.io/docs/concepts/services-networking/ingress/</a></li>\n<li><a href=\"https://kubernetes.io/docs/tasks/manage-kubernetes-objects/imperative-command/\">https://kubernetes.io/docs/tasks/manage-kubernetes-objects/imperative-command/</a></li>\n</ul>","excerpt":"TL; DR 아래의 명령어는 kubernetes 1.19 버전에서 진행하였습니다. 인증서 생성 인증서 생성(yaml) 인증서 교체 소개 쿠버네티스는 클러스터 외부에서 들어오는 L7 트래픽을 처리하기 위해 ingress resource…","timeToRead":1,"fields":{"slug":"/posts/tls-cert-secret-create-and-replace/"},"frontmatter":{"tags":["k8s","k8s-tls","k8s-secret"],"author":{"jsonId":"cprayer","bio":"","twitter":"@fabien0102","avatar":{"children":[{"fixed":{"src":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/b0b39/cprayer.jpg","srcSet":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/b0b39/cprayer.jpg 1x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/93542/cprayer.jpg 1.5x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/aa4d2/cprayer.jpg 2x"}}]}},"title":"kubernetes TLS 인증서 secret 생성 및 교체하기","updatedDate":"May 3, 2020","image":null}},"recents":{"edges":[{"node":{"fields":{"slug":"/posts/epoll-wait-failed-function-not-implemented/"},"timeToRead":1,"frontmatter":{"title":"netty epoll_wait(..) failed: Function not implemented 에러 이슈 해결 방법","image":null,"author":{"jsonId":"cprayer","avatar":{"children":[{"fixed":{"src":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg","srcSet":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg 1x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/fe190/cprayer.jpg 1.5x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/3e51d/cprayer.jpg 2x"}}]}}}}},{"node":{"fields":{"slug":"/posts/k8s-and-etc-resolv-conf/"},"timeToRead":3,"frontmatter":{"title":"k8s와 /etc/resolv.conf","image":null,"author":{"jsonId":"cprayer","avatar":{"children":[{"fixed":{"src":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg","srcSet":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg 1x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/fe190/cprayer.jpg 1.5x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/3e51d/cprayer.jpg 2x"}}]}}}}},{"node":{"fields":{"slug":"/posts/redis-manually-force-a-failover/"},"timeToRead":1,"frontmatter":{"title":"강제로 레플리카 레디스를 마스터로 승격시키기","image":null,"author":{"jsonId":"cprayer","avatar":{"children":[{"fixed":{"src":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg","srcSet":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg 1x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/fe190/cprayer.jpg 1.5x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/3e51d/cprayer.jpg 2x"}}]}}}}},{"node":{"fields":{"slug":"/posts/hbase-client-dns-excessive-query-issue/"},"timeToRead":2,"frontmatter":{"title":"hbase sharded client 1.2 dns 과다 질의 이슈","image":null,"author":{"jsonId":"cprayer","avatar":{"children":[{"fixed":{"src":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg","srcSet":"/static/5d0fd80a1d7df4f6a3adf452cc763c07/6d45f/cprayer.jpg 1x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/fe190/cprayer.jpg 1.5x,\n/static/5d0fd80a1d7df4f6a3adf452cc763c07/3e51d/cprayer.jpg 2x"}}]}}}}}]}},"pageContext":{"slug":"/posts/tls-cert-secret-create-and-replace/"}},"staticQueryHashes":[],"slicesMap":{}}